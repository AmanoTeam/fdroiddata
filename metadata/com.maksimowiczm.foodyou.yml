Categories:
  - Sports & Health
License: MPL-2.0
AuthorName: Mateusz Maksimowicz
SourceCode: https://github.com/maksimowiczm/FoodYou
IssueTracker: https://github.com/maksimowiczm/FoodYou/issues
Translation: https://crowdin.com/project/food-you

AutoName: FoodYou

RepoType: git
Repo: https://github.com/maksimowiczm/FoodYou
Binaries: https://github.com/maksimowiczm/FoodYou/releases/download/%v/food-you-%v.apk

Builds:
  - versionName: 1.0.1
    versionCode: 2
    commit: 1.0.1
    subdir: app
    sudo:
      - export CPUS_MAX=16
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    gradle:
      - opensource

  - versionName: 1.1.0
    versionCode: 3
    commit: 1.1.0
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    output: build/outputs/apk/release/*apk
    prebuild: gradle clean
    build:
      - mkdir upstream
      - pushd upstream
      - curl -L -o upstream.apk https://github.com/maksimowiczm/FoodYou/releases/download/$$VERSION$$/food-you-$$VERSION$$.apk
      - unzip -q upstream.apk
      - export upstreamhash=$(sha256sum assets/dexopt/baseline.prof|cut -d " " -f1)
      - popd
      - for i in {1..10}; do gradle clean assembleRelease; mkdir local; pushd local;
        unzip -q ../build/outputs/apk/release/*.apk; export localhash=$(sha256sum
        assets/dexopt/baseline.prof|cut -d " " -f1); [[ $localhash == $upstreamhash
        ]] && break ; popd; rm -fr local; done

AllowedAPKSigningKeys: cd74b0aedd8ead8184063a65909d639a8c885cf6465829690a9be83a8904bdea

AutoUpdateMode: Version
UpdateCheckMode: Tags ^[0-9.]+$
UpdateCheckData: gradle/libs.versions.toml|android-versionCode\s=\s\"(\d+)\"|.|version-name\s=\s\"([\d.]+)\"
CurrentVersion: 1.1.0
CurrentVersionCode: 3
